<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENBIC Tracking System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="layout-wrapper">
        <header>
            <h1>ENBIC Local Tracking System</h1>
            <div class="header-actions">
                <span id="userDisplay" style="margin-right:12px"></span>
                <button id="loginBtn" class="btn btn-secondary">Login</button>
                <button id="logoutBtn" class="btn btn-secondary" style="display:none">Logout</button>
                <button id="generateRemindersBtn" class="btn btn-secondary">Generate Reminders</button>
                <button id="refreshBtn" class="btn btn-secondary">Refresh</button>
            </div>
        </header>

        <div class="main-container">
            <nav class="sidebar">
                <div class="sidebar-menu">
                    <button class="sidebar-item active" data-view="dashboard">
                        <span class="sidebar-icon">üìä</span>
                        <span class="sidebar-label">Dashboard</span>
                    </button>
                    <button class="sidebar-item" data-view="arns">
                        <span class="sidebar-icon">üè∑Ô∏è</span>
                        <span class="sidebar-label">ARN Management</span>
                    </button>
                    <button class="sidebar-item" data-view="delivery">
                        <span class="sidebar-icon">üì¶</span>
                        <span class="sidebar-label">Delivery</span>
                    </button>
                    <button class="sidebar-item" data-view="states">
                        <span class="sidebar-icon">üó∫Ô∏è</span>
                        <span class="sidebar-label">States</span>
                    </button>
                    <button class="sidebar-item" data-view="inventory">
                        <span class="sidebar-icon">üìã</span>
                        <span class="sidebar-label">Inventory</span>
                    </button>
                    <button class="sidebar-item" data-view="reports">
                        <span class="sidebar-icon">üìà</span>
                        <span class="sidebar-label">Reports</span>
                    </button>
                </div>
            </nav>

            <div class="content-area">
                <!-- Dashboard View -->
                <div id="dashboard" class="view-content active">
                    <div class="view-header">
                        <h2>Dashboard</h2>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Awaiting Capture</h3>
                            <div class="stat-value" id="stat-awaiting">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Submitted</h3>
                            <div class="stat-value" id="stat-submitted">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Pending Delivery</h3>
                            <div class="stat-value" id="stat-pending">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Delivered</h3>
                            <div class="stat-value" id="stat-delivered">0</div>
                        </div>
                    </div>

                    <div class="view-sections">
                        <div class="section">
                            <h3>Active Reminders</h3>
                            <div id="remindersList" class="reminders-list"></div>
                        </div>
                        <div class="section">
                            <h3>Delivery Status by State</h3>
                            <div id="deliveryStats" class="delivery-stats"></div>
                        </div>
                    </div>
                </div>

                <!-- ARN Management View -->
                <div id="arns" class="view-content">
                    <div class="view-header">
                        <h2>ARN Management</h2>
                    </div>

                    <div class="view-sections">
                        <div class="section">
                            <h3>Add New ARN</h3>
                            <form id="addArnForm" class="form-inline">
                                <input type="text" id="arnInput" placeholder="Paste ARN here" required>
                                <input type="text" id="arnNameInput" placeholder="Applicant Name" style="margin-left:8px;">
                                <select id="stateSelect" required>
                                    <option value="">Select State</option>
                       
                    </select>
                    <button type="submit" class="btn btn-primary">Add ARN</button>
                </form>
            </div>

            <div class="section">
                <h2>ARN List</h2>
                <div class="filters">
                    <input type="text" id="searchInput" placeholder="Search by ARN..." class="filter-input">
                    <select id="filterState" class="filter-select">
                        <option value="">All States</option>
                    </select>
                    <select id="filterStatus" class="filter-select">
                        <option value="">All Statuses</option>
                        <option value="Awaiting Capture">Awaiting Capture</option>
                        <option value="Submitted to Personalization">Submitted to Personalization</option>
                        <option value="Pending Delivery">Pending Delivery</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                </div>
                <div id="arnsList" class="arns-list"></div>
            </div>
                    </div>
                </div>

                <!-- Delivery View -->
                <div id="delivery" class="view-content">
                    <div class="view-header">
                        <h2>Delivery</h2>
                    </div>
                    <div class="sections-container">
                        <div class="section">
                            <h3>State Delivery Confirmation</h3>
                            <p class="info-text">Select a state and confirm delivery. This will mark all pending ARNs for that state as delivered.</p>
                            <form id="deliveryForm" class="form-inline">
                                <select id="deliveryStateSelect" required>
                                    <option value="">Select State</option>
                                </select>
                                <textarea id="deliveryNotes" placeholder="Optional notes..." rows="2"></textarea>
                                <button type="submit" class="btn btn-primary">Confirm Delivery</button>
                            </form>
                        </div>

                        <div class="section">
                            <h3>Pending Deliveries by State</h3>
                            <div id="pendingDeliveries" class="pending-deliveries"></div>
                        </div>

                        <div class="section">
                            <h3>Dispatch Batches</h3>
                            <p class="info-text">Batches prepared for dispatch. Each batch requires operator and store officer signatures before dispatch. After delivery, upload the signed confirmation note to complete.</p>
                            <div id="dispatchBatches" class="dispatch-batches"></div>
                        </div>

                        <div class="section">
                            <h3>Delivery History</h3>
                            <div id="deliveryHistory" class="delivery-history"></div>
                        </div>
                    </div>
                </div>

                <!-- States View -->
                <div id="states" class="view-content">
                    <div class="view-header">
                        <h2>States</h2>
                    </div>
                    <div class="sections-container">
                        <div class="section">
                            <h3>Add New State</h3>
                            <form id="addStateForm" class="form-inline">
                                <input type="text" id="stateNameInput" placeholder="Enter state name (e.g., Sokoto, Bauchi)" required>
                                <button type="submit" class="btn btn-primary">Add State</button>
                            </form>
                        </div>

                        <div class="section">
                            <h3>Existing States</h3>
                            <div id="statesList" class="states-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Inventory View -->
                <div id="inventory" class="view-content">
                    <div class="view-header">
                        <h2>Inventory</h2>
                    </div>
                    <div class="sections-container">
                        <div class="section">
                            <h3>Blank Card Inventory</h3>
                            <div style="display:flex;gap:12px;align-items:center;">
                                <div><strong>Current Balance:</strong> <span id="inventoryBalanceTotal">0</span></div>
                                <div id="inventoryLowStock" style="color:#b00"></div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Receive Blank Cards</h3>
                            <form id="receiveForm" class="form-inline">
                                <input type="number" id="receiveQty" placeholder="Quantity" required>
                                <input type="text" id="receiveRef" placeholder="Reference / Batch">
                                <input type="text" id="receiveNotes" placeholder="Notes">
                                <button type="submit" class="btn btn-primary">Record Receipt</button>
                            </form>
                        </div>

                        <div class="section">
                            <h3>Receive Personalized Cards into Store</h3>
                            <p class="info-text">Paste ARNs (one per line) or comma-separated. Optionally set state.</p>
                            <textarea id="receiveArnsInput" rows="4" placeholder="ARN1\nARN2\n..."></textarea>
                            <select id="receiveArnsState">
                                <option value="">Keep existing state</option>
                            </select>
                            <button id="receiveArnsBtn" class="btn btn-primary">Register Received ARNs</button>
                            <div id="receiveArnsResult" style="margin-top:8px"></div>
                        </div>

                        <div class="section">
                            <h3>Record SHQ Pickup</h3>
                            <p class="info-text">Mark ARNs as collected at SHQ. Paste ARNs and provide collector details.</p>
                            <textarea id="pickupArnsInput" rows="3" placeholder="ARN1\nARN2"></textarea>
                            <input type="text" id="collectorName" placeholder="Collector name">
                            <input type="text" id="collectorId" placeholder="Collector ID / Ref">
                            <input type="text" id="collectorPhone" placeholder="Phone">
                            <button id="pickupArnsBtn" class="btn btn-primary">Record Pickup</button>
                            <div id="pickupArnsResult" style="margin-top:8px"></div>
                        </div>

                        <div class="section">
                            <h3>Issue To Personalization</h3>
                            <form id="issuePersoForm" class="form-inline">
                                <input type="number" id="issueQty" placeholder="Quantity" required>
                                <input type="text" id="issueTo" placeholder="Issued To (name/department)">
                                <input type="text" id="issueRef" placeholder="Run/Batch ref">
                                <button type="submit" class="btn btn-primary">Issue</button>
                            </form>
                        </div>

                        <div class="section">
                            <h3>Requests (Store Officer)</h3>
                            <div style="background:#f0f8ff;padding:10px;border-radius:4px;margin-bottom:12px;font-size:13px;border-left:4px solid #3498db;">
                                <strong>Store Officer:</strong> Submit blank card requests. Your requests will appear below with their approval status.<br/>
                                <strong>Admin/Operator:</strong> Review and approve/reject incoming requests.
                            </div>
                            <form id="requestForm" class="form-inline">
                                <input type="number" id="requestQty" placeholder="Quantity" required>
                                <input type="date" id="requestNeededBy" title="When do you need these cards?">
                                <input type="text" id="requestReason" placeholder="Reason" title="Why do you need these cards?">
                                <button type="submit" class="btn btn-primary">Create Request</button>
                            </form>
                            <div id="requestsList" style="margin-top:12px"></div>
                        </div>

                        <div class="section" id="adminRestockSection" style="display:none;">
                            <h3>Restock Central Inventory (Admin Only)</h3>
                            <div style="background:#fff3cd;padding:10px;border-radius:4px;margin-bottom:12px;font-size:13px;border-left:4px solid #ffc107;">
                                <strong>Add blank cards to the central inventory pool.</strong> This is where approved officer requests are deducted from and distributed.
                            </div>
                            <form id="restockForm" class="form-inline">
                                <input type="number" id="restockQty" placeholder="Quantity" required min="1">
                                <input type="text" id="restockRef" placeholder="Reference (PO#, Supplier, etc)">
                                <input type="text" id="restockNotes" placeholder="Notes">
                                <button type="submit" class="btn btn-primary">Add to Central Stock</button>
                            </form>
                            <div id="restockResult" style="margin-top:8px"></div>
                        </div>

                        <div class="section">
                            <h3>Ledger / Movements</h3>
                            <div style="margin-bottom:8px;display:flex;gap:8px;align-items:center;">
                                <button id="refreshLedger" class="btn btn-secondary">Refresh Ledger</button>
                            </div>
                            <div id="inventoryLedger"></div>
                        </div>

                        <div class="section">
                            <h3>Issue Notes</h3>
                            <div id="issueNotesList"></div>
                        </div>

                        <div class="section">
                            <h3>Reconciliation</h3>
                            <div id="reconResult"></div>
                            <button id="refreshRecon" class="btn">Refresh Reconciliation</button>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="reports" class="view-content">
                    <div class="view-header">
                        <h2>Reports</h2>
                    </div>
                    <div class="sections-container">
                        <div class="section">
                            <h3>Reports</h3>
                            <div class="reports-grid">
                                <div class="report-card">
                                    <h3>Pending Capture (Aging)</h3>
                                    <p>ARNs awaiting capture and personalization submission</p>
                                    <div class="report-actions">
                                        <button class="btn btn-secondary" onclick="viewReport('pending-capture')">View</button>
                                        <button class="btn btn-secondary" onclick="exportReport('pending-capture', 'excel')">Excel</button>
                                        <button class="btn btn-secondary" onclick="exportReport('pending-capture', 'pdf')">PDF</button>
                                    </div>
                                </div>
                                <div class="report-card">
                                    <h3>Submitted to Personalization</h3>
                                    <p>ARNs submitted for personalization</p>
                                    <div class="report-actions">
                                        <button class="btn btn-secondary" onclick="viewReport('submitted')">View</button>
                                        <button class="btn btn-secondary" onclick="exportReport('submitted', 'excel')">Excel</button>
                                        <button class="btn btn-secondary" onclick="exportReport('submitted', 'pdf')">PDF</button>
                                    </div>
                                </div>
                                <div class="report-card">
                                    <h3>Pending Delivery (In Transit)</h3>
                                    <p>ARNs in transit to final destination</p>
                                    <div class="report-actions">
                                        <button class="btn btn-secondary" onclick="viewReport('pending-delivery')">View</button>
                                        <button class="btn btn-secondary" onclick="exportReport('pending-delivery', 'excel')">Excel</button>
                                        <button class="btn btn-secondary" onclick="exportReport('pending-delivery', 'pdf')">PDF</button>
                                    </div>
                                </div>
                                <div class="report-card">
                                    <h3>Delivered</h3>
                                    <p>Completed deliveries by date range</p>
                                    <div class="report-actions">
                                        <button class="btn btn-secondary" onclick="viewReport('delivered')">View</button>
                                        <button class="btn btn-secondary" onclick="exportReport('delivered', 'excel')">Excel</button>
                                        <button class="btn btn-secondary" onclick="exportReport('delivered', 'pdf')">PDF</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>Custom Report</h3>
                            <div style="display:flex;gap:8px;margin-bottom:10px;">
                                <input type="date" id="reportStartDate" placeholder="Start date">
                                <input type="date" id="reportEndDate" placeholder="End date">
                                <select id="reportFilterType">
                                    <option value="">All Types</option>
                                    <option value="arn">ARN Status</option>
                                    <option value="state">State Delivery</option>
                                </select>
                                <button id="exportReportExcel" class="btn btn-secondary">Excel</button>
                                <button id="exportReportPdf" class="btn btn-secondary">PDF</button>
                            </div>
                            <div id="reportContent" class="report-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Status Update Modal -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Update Status</h2>
            <p>ARN: <strong id="modalArn"></strong></p>
            <p>Current Status: <strong id="modalCurrentStatus"></strong></p>
            <select id="modalNewStatus" class="form-select"></select>
            <button id="confirmStatusBtn" class="btn btn-primary">Confirm Update</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" id="loginClose">&times;</span>
            <h2>Login</h2>
            <form id="loginForm">
                <input type="text" id="loginUsername" placeholder="Username" required />
                <input type="password" id="loginPassword" placeholder="Password" required />
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            <div id="loginError" style="color:#b00;margin-top:8px;display:none"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
